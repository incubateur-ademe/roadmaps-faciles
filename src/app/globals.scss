@use "tailwindcss";

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ==============================
   shadcn/ui design tokens
   Scoped to [data-ui-theme="Default"]
   ============================== */
[data-ui-theme="Default"] {
    --background: oklch(1 0 0);
    --foreground: oklch(0.145 0 0);
    --card: oklch(1 0 0);
    --card-foreground: oklch(0.145 0 0);
    --popover: oklch(1 0 0);
    --popover-foreground: oklch(0.145 0 0);
    --primary: oklch(0.205 0 0);
    --primary-foreground: oklch(0.985 0 0);
    --secondary: oklch(0.97 0 0);
    --secondary-foreground: oklch(0.205 0 0);
    --muted: oklch(0.97 0 0);
    --muted-foreground: oklch(0.556 0 0);
    --accent: oklch(0.97 0 0);
    --accent-foreground: oklch(0.205 0 0);
    --destructive: oklch(0.577 0.245 27.325);
    --destructive-foreground: oklch(0.577 0.245 27.325);
    --border: oklch(0.922 0 0);
    --input: oklch(0.922 0 0);
    --ring: oklch(0.708 0 0);
    --radius: 0.625rem;
    --sidebar-background: oklch(0.985 0 0);
    --sidebar-foreground: oklch(0.145 0 0);
    --sidebar-primary: oklch(0.205 0 0);
    --sidebar-primary-foreground: oklch(0.985 0 0);
    --sidebar-accent: oklch(0.97 0 0);
    --sidebar-accent-foreground: oklch(0.205 0 0);
    --sidebar-border: oklch(0.922 0 0);
    --sidebar-ring: oklch(0.708 0 0);
    --chart-1: oklch(0.646 0.222 41.116);
    --chart-2: oklch(0.6 0.118 184.714);
    --chart-3: oklch(0.398 0.07 227.392);
    --chart-4: oklch(0.828 0.189 84.429);
    --chart-5: oklch(0.769 0.188 70.08);
}

[data-ui-theme="Default"][data-fr-theme="dark"] {
    --background: oklch(0.145 0 0);
    --foreground: oklch(0.985 0 0);
    --card: oklch(0.145 0 0);
    --card-foreground: oklch(0.985 0 0);
    --popover: oklch(0.145 0 0);
    --popover-foreground: oklch(0.985 0 0);
    --primary: oklch(0.985 0 0);
    --primary-foreground: oklch(0.205 0 0);
    --secondary: oklch(0.269 0 0);
    --secondary-foreground: oklch(0.985 0 0);
    --muted: oklch(0.269 0 0);
    --muted-foreground: oklch(0.708 0 0);
    --accent: oklch(0.269 0 0);
    --accent-foreground: oklch(0.985 0 0);
    --destructive: oklch(0.396 0.141 25.723);
    --destructive-foreground: oklch(0.637 0.237 25.331);
    --border: oklch(0.269 0 0);
    --input: oklch(0.269 0 0);
    --ring: oklch(0.439 0 0);
    --sidebar-background: oklch(0.205 0 0);
    --sidebar-foreground: oklch(0.985 0 0);
    --sidebar-primary: oklch(0.488 0.243 264.376);
    --sidebar-primary-foreground: oklch(0.985 0 0);
    --sidebar-accent: oklch(0.269 0 0);
    --sidebar-accent-foreground: oklch(0.985 0 0);
    --sidebar-border: oklch(0.269 0 0);
    --sidebar-ring: oklch(0.439 0 0);
    --chart-1: oklch(0.488 0.243 264.376);
    --chart-2: oklch(0.696 0.17 162.48);
    --chart-3: oklch(0.769 0.188 70.08);
    --chart-4: oklch(0.627 0.265 303.9);
    --chart-5: oklch(0.645 0.246 16.439);
}

.field-sizing-content {
    field-sizing: content;
}

.field-sizing-fixed {
    field-sizing: fixed;
}

/* background */

/* -- custom */
.no-bg {
    background: none;
}

code {
    background-color: var(--background-lifted-grey);
    color: var(--text-label-grey);
    padding: 0.2em 0.5em;
    border-radius: 5px;
    font-size: 0.95em;
    box-shadow: inset 0 0 0 1px var(--border-default-grey);
    filter: drop-shadow(var(--raised-shadow));
    white-space: pre-wrap;
    word-break: break-word;
}

code:hover {
    background-color: var(--background-lifted-grey-hover);
    transition: background-color 0.3s ease;
}

/* === */

/* === based on dsfr === */


/* Fix: DSFR collapse initial state with React.
 * DSFR JS (window.dsfr.start()) may not have initialized yet when React renders
 * aria-expanded="true". This CSS forces the collapse open until DSFR JS takes over
 * (adds fr-collapse--expanded), then this rule stops matching. */
.fr-sidemenu [aria-expanded="true"]+.fr-collapse:not(.fr-collapse--expanded):not(.fr-collapsing) {
    --collapse-max-height: none;
    visibility: visible;
}

/* typo */
.text-dsfr-neutral {
    color: var(--text-default-grey);
}

.text-dsfr-success {
    color: var(--text-default-success);
}

.text-dsfr-warning {
    color: var(--text-default-warning);
}

.text-dsfr-error {
    color: var(--text-default-error);
}

.text-dsfr-action-high-blue-france {
    color: var(--text-action-high-blue-france);
}

/* background */
.bg-dsfr-alt-grey {
    background-color: var(--background-alt-grey);
}

/* === */

svg.dsfr-svg {
    --color: var(--artwork-major-blue-france);
}

svg.dsfr-svg-hover:hover {
    --color: var(--artwork-major-blue-france-hover);
}

svg.dsfr-svg-active:active {
    --color: var(--artwork-major-blue-france-active);
}


/* === shine === */
.shimmer {
    mask: linear-gradient(-60deg, #000 30%, #0003, #000 70%) right/300% 100%;
    background-repeat: no-repeat;
    animation: 20s ease-out infinite shimmer;
}

@keyframes shimmer {

    10%,
    100% {
        mask-position: left
    }
}

$postStatusColor: (
    grey: "grey",
    blueFrance: "blue-france",
    redMarianne: "red-marianne",
    greenTilleulVerveine: "green-tilleul-verveine",
    greenBourgeon: "green-bourgeon",
    greenEmeraude: "green-emeraude",
    greenMenthe: "green-menthe",
    greenArchipel: "green-archipel",
    blueEcume: "blue-ecume",
    blueCumulus: "blue-cumulus",
    purpleGlycine: "purple-glycine",
    pinkMacaron: "pink-macaron",
    pinkTuile: "pink-tuile",
    yellowTournesol: "yellow-tournesol",
    yellowMoutarde: "yellow-moutarde",
    orangeTerreBattue: "orange-terre-battue",
    brownCafeCreme: "brown-cafe-creme",
    brownCaramel: "brown-caramel",
    brownOpera: "brown-opera",
    beigeGrisGalet: "beige-gris-galet",
    info: "info",
    success: "success",
    warning: "warning",
    error: "error",
);

@each $name, $dsfrColor in $postStatusColor {

    .fr-badge.fr-badge--color-#{""+$name},
    .fr-roadmap-column--color-#{""+$name} {
        color: var(--text-action-high-#{$dsfrColor});
        background-color: var(--background-contrast-#{$dsfrColor});
        --idle: transparent;
        --hover: var(--background-contrast-#{$dsfrColor}-hover);
        --active: var(--background-contrast-#{$dsfrColor}-active);
    }
}

.reseted-hr {
    padding: initial;
    margin: initial;
    border: initial;
    border-width: 1px;
    border-color: var(--border-default-grey);
    border-style: solid;
    background: initial;
    background-image: initial;
}

.scrollbar-thin {
    scrollbar-width: thin;
}


/* ==============================
   Menu utilisateur DSFR étendu
   ============================== */
.fr-user-menu {
    --rows: 8;
    position: relative;
    text-align: initial;
    margin-top: -1rem !important;

    /* --- Bouton principal --- */
    &__btn {
        margin-bottom: 0 !important;

        &[aria-expanded="true"] &-label:after {
            transform: rotate(-180deg);
        }

        /* Icône droite (chevron) */
        &-label:after {
            transition: transform 0.3s;
        }

        &[aria-expanded="true"] {
            color: var(--text-active-blue-france);
            background-color: var(--background-open-blue-france) !important;
            --idle: transparent;
            --hover: var(--background-open-blue-france-hover);
            --active: var(--background-open-blue-france-active);
        }
    }

    /* --- Réinitialisations DSFR inutiles --- */
    .fr-nav__item:before {
        content: none;
    }

    .fr-menu__list {
        background-color: var(--background-alt-grey);
    }

    /* --- En-tête utilisateur --- */
    &__header {
        padding: 1rem 1.25rem;
    }

    &__name {
        font-weight: bold;
        margin-bottom: 0.25rem;
    }

    &__email {
        color: var(--text-mention-grey);
    }

    /* --- Liens du menu --- */
    .fr-nav__link {
        transition: background-color 0.2s ease, color 0.2s ease;
        justify-content: start;

        &>.fr-icon {
            margin-right: 0.5rem;
        }

        &:hover,
        &:focus {
            background-color: var(--background-alt-grey-hover);
            color: var(--text-action-high-blue-france);
        }
    }


    /* --- Bouton de déconnexion --- */
    &__logout {
        display: flex;
        justify-content: center;

        &>button.fr-btn,
        &>a.fr-btn {
            flex: 1 !important;
            margin: 1rem !important;
            justify-content: center !important;
        }
    }

    /* --- Responsive desktop --- */
    @media (width >=62em) {
        .fr-user-menu {
            &__btn {
                &-label:after {
                    margin-left: 0.25rem;
                    margin-right: -0.25rem;
                }
            }

            /* --- Menu déroulant --- */
            &__menu {
                padding: 0 !important;
                left: .25rem !important;
                margin: 0 !important;
            }
        }

        .fr-menu__list {
            grid-template-rows: repeat(var(--rows), auto);
            grid-auto-flow: column;
            display: grid;
        }
    }

    /* --- Accessibilité : réduit les animations --- */
    @media (prefers-reduced-motion: reduce) {
        .fr-user-menu {

            &__btn-label:after,
            &__menu {
                transition: none;
            }
        }
    }
}

/* ----- */

/* Prisma Sudio */
:root .ps {
    --background: var(--background-default-grey);
    --foreground: var(--text-default-grey);
    --primary: var(--background-action-high-blue-france);
    --primary-foreground: var(--text-inverted-blue-france);
    --secondary: var(--background-lifted-grey);
    --secondary-foreground: var(--text-action-high-blue-france);
    --popover: var(--background-lifted-grey);
    --popover-foreground: var(--text-default-grey);
    --border: var(--border-default-grey);
    --input: var(--border-action-high-blue-france);
    --ring: 35.5 91.7% 32.9%;
    --card: var(--background-alt-grey);
    --card-foreground: var(--text-default-grey);
    --muted: var(--background-disabled-grey);
    --muted-foreground: var(--text-label-grey);
    --accent: var(--background-action-high-blue-france);
    --accent-foreground: var(--text-inverted-blue-france);
    --destructive: var(--background-flat-error);
    --destructive-foreground: var(--text-error);
    --color-green-500: var(--background-flat-success);
    --font-sans: 'Marianne', sans-serif;
    --text-lg: 1rem;
    --text-sm: 0.875rem;
}

.ps .data-\[active\=true\]\:text-foreground[data-active="true"] {
    background-color: var(--background-action-high-blue-france) !important;
    color: var(--text-inverted-blue-france) !important;
}

.ps .data-\[active\=true\]\:text-foreground[data-active="true"]:hover {
    color: var(--text-blue-france) !important;
    color: var(--text-inverted-blue-france) !important;
}

.ps button[class~="hover:text-accent-foreground"]:hover {
    color: var(--text-blue-france) !important;
}

.ps tr {
    --muted: var(--background-alt-grey) !important;
}

/* Consent management button — style as DSFR secondary button when outside footer */
.consent-btn-wrapper {
    display: inline-block;

    .fr-footer__bottom-link {
        all: unset;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        line-height: 1.5rem;
        font-weight: 500;
        cursor: pointer;
        color: var(--text-action-high-blue-france);
        background-color: transparent;
        box-shadow: inset 0 0 0 1px var(--border-action-high-blue-france);

        &:hover {
            background-color: var(--background-action-high-blue-france-hover);
        }

        &:active {
            background-color: var(--background-action-high-blue-france-active);
        }

        &:focus-visible {
            outline: 2px solid var(--border-action-high-blue-france);
            outline-offset: 2px;
        }
    }
}
