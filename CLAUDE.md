# CLAUDE.md — Kokatsuna / Roadmaps Faciles

## Tooling & environment
- `pnpm` is the package manager; lock file is `pnpm-lock.yaml`
- Node 24 required (`engines` in package.json)
- Next.js 16 App Router, standalone output, React Compiler enabled
- Prisma 7 — client is auto-generated into `src/generated/prisma/`; never edit manually
- `next-env.d.ts` is auto-generated by Next.js; ignore changes to it

## Scripts
- `pnpm dev` — start dev server
- `pnpm build` — production build
- `pnpm lint` — runs `next typegen && eslint`
- `pnpm prisma db seed` — seed dev database
- `pnpm prisma:studio` — open Prisma Studio (embedded in admin UI)

## Local services (docker-compose)
- PostgreSQL 15 → `localhost:5432` (db: roadmaps-faciles, user/pass: postgres/postgres)
- Redis → `localhost:6379`
- Maildev SMTP → `localhost:1025` (web UI: localhost:1080)

## Code conventions
- ESLint 9 flat config (`eslint.config.ts`) — strict rules enforced:
  - No default exports except Next.js special files (page, layout, error, loading, template, route, metadata)
  - Imports must be sorted (perfectionist plugin)
- Path aliases (tsconfig): `@/*` → `src/*`, `@/utils/*` → `src/lib/utils/*`, `@/prisma/*` → `src/generated/prisma/*`
- UI: DSFR (French gov design system) is primary; components/utilities in `src/dsfr/`
- Styles: Tailwind CSS 4 + SCSS (`globals.scss`)

## Architecture
- Multi-tenant: domain-based routing via `src/app/[domain]/`
- Auth: NextAuth v5 beta (`src/lib/next-auth/`), Espace Membre provider
- Data layer: Prisma repos in `src/lib/repo/`, services in `src/lib/services/`, use cases in `src/useCases/`
- Caching: Redis via ioredis + unstorage
- Email: Nodemailer (maildev in dev)

## Gotchas
- `src/generated/` is gitignored (except `.gitattributes`) — run `pnpm prisma generate` if client is missing
- Zod 4 is used (not v3) — API differs slightly
